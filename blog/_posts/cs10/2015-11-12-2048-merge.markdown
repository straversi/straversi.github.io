---
layout: post
title:  "2048 Merge"
date:   2015-11-12 11:47:36 -0000
categories: cs10
description: "Explore creating an intuitive algorithm for 2048."
custom_css: 2048_board
custom_js: 2048_board_merge
---
<!-- JavaScript and CSS loaded in _includes/head.html. Check front matter. -->
{% capture asset_path %}{{site.baseurl}}/assets/posts{{page.url}}/{% endcapture %}

In the fad game 2048, you press arrow keys to move tiles across a board in
one of four possible directions. Let's explore an intuitive algorithm for
accomplishing this.

* * *

##Basic Slide

Let's start with the case of a single tile.

<span class="important">Note:</span> Throughout this exploration, we will
only ever be considering a single column. This is because in a true 2048
board with 4 columns, each column is independent from the rest when it
comes to merging tiles upward.

What happens when we press the UP arrow? The tile should move up until it
hits an edge.

<div class="board-wrapper">
<div class="board-2048" style="width:62.5px;height:250px;">
  <img class="tile" data-val="2" data-endval="2" data-begin="3" data-end="0">
</div>
<label onclick="mergeBoard(this)"><input type="checkbox"><span>merge up</span></label>
</div>

Let's start a list of rules that we have to keep in mind. We'll keep adding
to it as we go.

Rules

>1. Move up until:
>  * There is an edge


##Another Tile

Now we'll progress our algorithm by looking at a more complex board. It will
have two tiles of different values.

What happens when we press the UP arrow? The top tile, following our rules
list, will move up until there is an edge. Then it's the bottom tile's turn.
It starts to move up... and then encounters a new situation. Instead of
hitting an edge, it hits another tile. What should happen?

<div class="board-wrapper">
<div class="board-2048" style="width:62.5px;height:250px;">
  <img class="tile" data-val="2" data-endval="2" data-begin="1" data-end="0">
  <img class="tile" data-val="4" data-endval="4" data-begin="3" data-end="1">
</div>
<label onclick="mergeBoard(this)"><input type="checkbox"><span>merge up</span></label>
</div>

The tile should stop as if it has hit an edge. It now occupies the spot
directly under the tile above it. Let's update our rules to reflect
this:

>1. Move up until:
>  * There is an edge
>  * There is another tile

<span class="important">Notice:</span> This brings up a question. Which tile should we move up first? If we move the bottom tile up first, it would stop when it got to the
tile above it. Then we'd move the tile above it, and it'd stop at the edge.
What's left is a gap between the two tiles! This is not what we want.
Therefore, we'll make an observation that we should move the tiles up in
order from top to bottom.

##Merging Tiles

If you missed the notice right before this section definitely read it.

Let's make things more complex again. In our newest board, there are two
tiles of the same value.

What happens when we press the UP arrow? Now things are getting interesting.
The top tile, following our rules list, will move up until there is an edge.
Then it's the bottom tile's turn. It starts to move up... and then
encounters a new situation. It hits another tile with the same value. What
should happen?

<div class="board-wrapper">
<div class="board-2048" style="width:62.5px;height:250px;">
  <img class="tile" data-val="2" data-endval="4" data-begin="1" data-end="0">
  <img class="tile" data-val="2" data-endval="0" data-begin="3" data-end="0">
</div>
<label onclick="mergeBoard(this)"><input type="checkbox"><span>merge up</span></label>
</div>

The tiles should merge into a new tile of twice their values. Let's add a
rule:

>1. Move up until:
>  * There is an edge
>  * There is another tile...
>       * Different value? Do nothing.
>       * Same value? Merge with it.

##Merge Mishaps

Let's add one more twist of complexity. Our next board will have three tiles
on it: Two of the same value and one of twice their value.

What happens when we press the UP arrow? The top tile, following our rules
list, will move up until there is an edge. Then it's the next tile's turn.
It moves up and encounters a tile. Does it have the same value? Yes it does,
so it will merge into it to make a new tile of twice its value. Then it's
the bottom tile's turn. It moves up, and encounters the freshly merged tile
above it... What should happen?

<div class="board-wrapper">
<div class="board-2048" style="width:62.5px;height:250px;">
  <img class="tile" data-val="4" data-endval="8" data-begin="1" data-end="0">
  <img class="tile" data-val="4" data-endval="0" data-begin="2" data-end="0">
  <img class="tile" data-val="8" data-endval="8" data-begin="3" data-end="1">
</div>
<label onclick="mergeBoard(this)"><input type="checkbox"><span>merge up</span></label>
</div>

The third tile should stop! One of the rules of 2048 is that a tile cannot
be merged more than once per key press. Let's add a rule to take care of
this:

>1. Move up until:
>  * There is an edge
>  * There is another tile...
>       * Different value? Do nothing.
>       * Same value?
>           * Already merged that tile? Do nothing.
>           * Haven't merged that tile yet? Merge with it.

We have all of the parts of a perfectly fine 2048 Merging algorithm. These
simple rules are all it takes to power an addicting and popular game. There
are more things we could do: perhaps you may find it useful to keep track of
whether or not a tile has been moved as a result of attempting a merge (this
could be useful when deciding whether to add a new tile when implementing
a full 2048 game).

<br>

You can write this algorithm iteratively or recursively. Explore, and
write your own improved version now that you understand the basics.
There are many other ways to achieve the merge effect, and some solutions
can get very clever and efficient. <span>&#9632</span>

# TESTING
![Image of Yaktocat]({{asset_path}}test.png)

<script>
  // Run setup method. Find in 2048_board_merge.js from YAML front matter.
  tileSetup("{{asset_path}}2048_tiles/");
</script>
